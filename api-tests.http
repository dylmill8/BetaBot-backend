# =========================================
# VS Code REST Client — Stage 2 API tests
# Uses .env: API_HOST, API_PORT
# =========================================

@host = {{$dotenv API_HOST}}
@port = {{$dotenv API_PORT}}
@base = http://{{host}}:{{port}}
@json = application/json
@climb_a_id = 7
@climb_b_id = 6
@log_id = 3

###############################################################
#                          CLIMBS                             #
###############################################################

### List climbs
GET {{base}}/api/climbs/
Accept: application/json

### Create climb A
# @name CreateClimbA
POST {{base}}/api/climbs/
Content-Type: {{json}}

{"owner_id":1,"name":"Moon Arete","grade_label":"V3","grade_index":3,"location":"Kilter Board"}

### Get climb A
GET {{base}}/api/climbs/{{climb_a_id}}/
Accept: application/json

### Create climb B (for logs)
# @name CreateClimbB
POST {{base}}/api/climbs/
Content-Type: {{json}}

{"owner_id":1,"name":"Hammer Drop","grade_label":"V8","grade_index":8,"location":"Kilter Board"}

### Get climb B
GET {{base}}/api/climbs/{{climb_b_id}}/
Accept: application/json

### Update climb A (PUT — full replace)
PUT {{base}}/api/climbs/{{climb_a_id}}/
Content-Type: {{json}}

{"name":"Moon Arete (Updated)","grade_label":"V4","grade_index":4,"location":"Kilter Board"}

### Update climb A (PATCH — partial update)
PATCH {{base}}/api/climbs/{{climb_a_id}}/
Content-Type: {{json}}

{"location":"Home Wall"}

### Delete climb A
DELETE {{base}}/api/climbs/{{climb_a_id}}/
Accept: */*

### Delete climb B
DELETE {{base}}/api/climbs/{{climb_b_id}}/
Accept: */*

###############################################################
#                           LOGS                              #
###############################################################

### GET all logs (default sorted by newest date)
GET {{base}}/api/logs/
Accept: application/json

### Create a new log for climb 1
POST {{base}}/api/logs/
Content-Type: {{json}}

{
  "climb": {{climb_a_id}},
  "date": "2025-11-03",
  "attempts": 3,
  "sent": true,
  "note": "Felt solid on the send"
}

### Create a new log for climb 2
POST {{base}}/api/logs/
Content-Type: {{json}}

{
  "climb": {{climb_b_id}},
  "date": "2025-11-03",
  "attempts": 3,
  "sent": true,
  "note": "Felt solid on the send"
}

### Full update of an existing log
PUT {{base}}/api/logs/{{log_id}}/
Content-Type: {{json}}

{
  "climb": {{climb_a_id}},
  "date": "2025-11-03",
  "attempts": 4,
  "sent": true,
  "note": "Took another go and improved!"
}

### PATCH Partial update
PATCH {{base}}/api/logs/{{log_id}}/
Content-Type: {{json}}

{ "note": "Updated partial note" }


### DELETE an existing log
DELETE {{base}}/api/logs/{{log_id}}/
Accept: */*


###############################################################
#                   FILTERS & SORTING                         #
###############################################################

### GET logs filtered and sorted by grade range & date
GET {{base}}/api/logs/?min_grade=2&max_grade=8&sort=asc
Accept: application/json


###############################################################
#                            REPORT                           #
###############################################################

### GET aggregate stats on logs (total sends, average attempts, best grade)
GET {{base}}/api/logs/report?min_grade=0&max_grade=10
Accept: application/json